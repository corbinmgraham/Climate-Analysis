---
title: "DS202-FinalProject"
author: "Corbin Graham, Coleman Dimmer"
date: "2023-11-09"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# DS 201 Final Project

Corbin Graham, Coleman Dimmer

## Description

The goal of this project is to demonstrate climate trends related to temperature throughout time. We are using data provided by National Centers for Environmental Information (NCEI) for the Milan weather recording station of Milan, Italy. Using graphs, charts, and statistical analysis, we will be able to visualize and demonstrate climate trends for this location.

We chose this location due to the timeframe and data provided. We will be using monthly weather (temperature) data from January 1763 to November 2008.

### Libraries

```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
```

## Dataset

[Milan Weather Recording Station from NCEI](https://www.ncei.noaa.gov/access/search/data-search/global-summary-of-the-month?startDate=1800-01-03T00:00:00&endDate=1800-01-03T23:59:59)

### Importing Data

```{r}
data <- read_csv("milan.csv")
head(data)
```

### Data Timeframe

```{r}
min(data$DATE)
max(data$DATE)
```

### Data Columns

```{r}

colnames(data)

```

### Data Description

The dataset we chose is monthly climate data recorded in Milan, Italy, between January 1763 and November 2008. We can use this data to analyze climate patterns. etc.

## Cleaning the Data

Drop null values, drop precipitation data (due to lack of data within timeframe)

```{r}

#Grabs data and names columns to more reasonable col names. NOTE: DX and DY values are in degrees F, so changed to more accurate degrees C titles to match all other vars. 
milanClimate <- data %>%
  select(
    DATE,
    MEAN = TAVG,
    MEAN_MAX = TMAX,
    MEAN_MIN = TMIN,
    HEAT_DEG_DAYS = HTDD,
    COOL_DEG_DAYS = CLDD,
    HIGHEST_TEMP = EMXT,
    HIGHEST_DAY = EMXT_ATTRIBUTES,
    COOLEST_TEMP = EMNT,
    COOLEST_DAY = EMNT_ATTRIBUTES,
    GTE_32 = DX90,
    GTE_21 = DX70,
    GTE_00 = DX32,
    LTE_00 = DT32,
    LTE_N18 = DT00
  )

milanClimate$DATE <- lubridate::ym(milanClimate$DATE)

milanClimate$HIGHEST_DAY <- as.numeric(substr(gsub('\\D','',milanClimate$HIGHEST_DAY), nchar(gsub('\\D','',milanClimate$HIGHEST_DAY))-1, nchar(gsub('\\D','',milanClimate$HIGHEST_DAY))))

milanClimate$COOLEST_DAY <- as.numeric(substr(gsub('\\D','',milanClimate$COOLEST_DAY), nchar(gsub('\\D','',milanClimate$COOLEST_DAY))-1, nchar(gsub('\\D','',milanClimate$COOLEST_DAY))))

colnames(milanClimate)
```

## Marginal Summaries

### Max Temperature and Minimum Temperature with Date

```{r}

subset_min <- milanClimate %>%
  filter(MEAN == min(MEAN, na.rm = TRUE)) %>%
  select(DATE, MEAN, MEAN_MIN, MEAN_MAX)
subset_min

subset_max <- milanClimate %>%
  filter(MEAN == max(MEAN, na.rm = TRUE)) %>%
  select(DATE, MEAN, MEAN_MIN, MEAN_MAX)
subset_max

subset_min_max <- bind_rows(subset_min, subset_max)
subset_min_max # Highest and Lowest Temperatures

ggplot(milanClimate, aes(x=DATE, y=MEAN)) +
  geom_bar(stat="identity", fill="blue", width=0.5) +
  geom_errorbar(aes(ymin = MEAN_MIN, ymax = MEAN_MAX), width = 0.2, position = position_dodge(width = 0.5)) +
  labs(x="Date", y="Temperature (C)") +
  ggtitle("Temperature Ranges by Date")

```

```{r}
# Monthly averages

ggplot(milanClimate, aes(x=DATE, y=MEAN)) +
  geom_point(color='blue') +
  geom_smooth(method='lm', color='red') +
  labs(x="Date", y="Temperature (C)") +
  ggtitle("Average Temperature by Date with Trend")
```

```{r}
# Assuming data is your dataframe

# Extract year from the "date" column
new_data <- milanClimate %>%
  mutate(year = lubridate::year(DATE))

# Create a summary dataframe with yearly statistics
summary_df <- new_data %>%
  group_by(year) %>%
  summarise(
    MEAN = mean(MEAN, na.rm = TRUE),
    MIN = min(MEAN_MIN, na.rm = TRUE),
    MAX = max(MEAN_MAX, na.rm = TRUE)
  )
summary_df

# Print the summary dataframe
ggplot(summary_df, aes(x=year, y=MEAN)) +
  geom_bar(stat="identity", fill="blue", width=0.5) +
  geom_smooth(method='lm', color='red') +
  labs(x="Date", y="Temperature (C)") +
  ggtitle("Annual Temperature Range with Trend")
```

## 2 Plans for Data Exploration

With the data, we plan to explore the shift of temperatures in the Milan area. Combining this with economic data from the area can share how the shift in temperature has aftected the economy. Or combining it with populaiton data, we can compare it with population shifts. Across the data, we should be able to find comparisons between the temperature and other local events.
